---
title: 领域驱动设计代码实践
categories:
- micro

tags:
- DDD
---

领域驱动设计代码实现
<!--more-->


# DDD 基础概念
* 实体
* 值对象
* 聚合
* 领域服务
* 防腐层
* 仓库
* 工厂

# DDD 四层架构规范
* 领域中的对象由实体和值对象组成，对值对象的访问必须经由所需的实体对象
* 相关联的一组实体和值对象组成聚合，对聚合内对象的访问必须经由聚合根对象
* 跨实体的操作必须经由领域服务
* 应用服务层只通过领域服务或者聚合根来组织业务，自身不带任何逻辑实现
* 业务与数据隔离，领域层只关注业务，数据支撑全部交由基础设施层


# 代码实现原则



## 实体
* 每个实体只能操作自己的属性
* 跨实体的状态变化需要抽象成领域服务

## 值对象





# 软件退化的根源



## 为什么软件会退化，会随着变更而设计质量下降呢？

* 软件的本质就是对真实世界的模拟
* 软件中业务逻辑正确与否的唯一标准就是是否与真实世界一致



## 开放-封闭原则（OCP）

### 开放原则

对于功能扩展是开放的（open for Extension），即当系统需求发生变更时，可以对软件功能进行扩展，使其满足用户新的需求

### 封闭原则

对软件代码修改是封闭的（close for modification）即在修改软件的溶蚀，不要影响到系统原有的功能，所以应当在不修改原有代码的基础上实现新功能



## 单一职责原则

软件系统中的每个元素只完成自己职责范围内的事，而将其它的事交给别人去做，我只是调用。

####  什么是高质量的代码？

当用户提出一个需求变更时，为了实现这个变更而修改软件的成本越低，软件的设计质量就越高



单一职责原则要求在维护软件的过程中需要不断地进行整理  

将软件变化同一个原因的代码放在一起  

将软件变化不同的原因的代码分开放  





## DDD落实到数据库设计的整个过程

* 传统4种关系可以直接转换
* 继承关系有3种转换方案
* 转换成NoSQL 数据库是完全不同的思路



## 领域模型如何指导程序设计

### 服务（service）

标识的是在领域对象之外的操作与行为，接收用户的请求和执行某些操作  



### 实体

通过一个唯一标识字段区分真实世界中的每一个个体的领域对象  



### 值对象

是真实世界中那些一成不变的，本质性的事物，这样的领域对象叫值对象  



## 充血模型VS贫血模型

#### 充血模型

充血模型保持了领域模型的原貌，可以比较直接地映射程序的变更，代码修改起来比较直接  

保持了对象的封装性，使得领域模型在面临多态、继承等复杂结构时，易于变更。  

充血模型需要开发人员具有更强的OOA/D能力、分析业务、业务建模与设计能力

#### 需要封装起来按照充血模型设计的业务逻辑

* 在领域模型中出现了类似继承、多态的情况
* 在软件设计过程中需要将一些类型或者编码进行转换
* 希望在软件设计中能更好的表现领域对象之间的关系
* “聚合” 在真实世界中那些代表整体与部分的事物

### 总结

领域模型的最终落地是三种类型的对象：服务、实体、值对象  

设计思路：贫血模型与充血模型  

