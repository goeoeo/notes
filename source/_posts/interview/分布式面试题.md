---
title: 分布式面试题
categories: 
- interview
tags:
- 面试题
---



<!--more-->

# 分布式基础
## 简述CAP理论
在分布式系统中，一致性（Consistency）、可用性（Availability）和分区容忍性（Partition Tolerance）这三个特性无法同时满足  
1. 一致性（Consistency）：要求系统中的所有节点在同一时间具有相同的数据视图。即在数据写入后，所有相关的读操作都能读取到最新的数据。
2. 可用性（Availability）：系统提供的服务应该一直处于可用状态，即对用户的每个请求都应该得到响应，无论系统是否出现故障。
3. 分区容忍性（Partition Tolerance）：指系统能够在网络分区的情况下继续运行。即使系统中的节点或通信发生故障，系统仍然能够保持可用状态。

分布式架构中 P 必须存在


## 简述BASE理论
cap理论的一种妥协，由于cap只能取其一，base理论降低了发送分区容错时对可用性和一致性的要求  
1. 基本可用：允许可用性降低（可能响应时间延长，可能服务降级）
2. 软状态：指允许系统中的数据存在中间状态，并任务该中间状态不会影响系统整体的可用性
3. 最终一致性： 节点同步数据可以存在延迟，但在一定的期限后必须达成数据一致的状态。

## raft算法
Raft 算法是一种一致性算法，用于管理多副本状态机的日志复制。  
在 Raft 算法中，系统中的角色被分为三种：Leader、Follower 和 Candidate。Leader 负责处理客户端请求并同步日志到其他节点。Follower 则等待来自 Leader 的指令。在 Leader 选举过程中，节点会临时成为 Candidate，负责发起选举。

## 负载均衡的策略
1. 轮询
2. 加权轮询
3. 随机
4. 加权随机
5. 源地址哈希
6. 最小连接法



# 分布式框架


# 分布式事务
1. 2PC: 协调者通过询问参与者的状态来确保所有参与者都准备就绪，然后统一执行提交或者回滚
2. TCC(Try-Confirm-Cancel): 每个服务提供者自己实现try,confirm,cancel,协调者负责协调不同服务的操作流程，阻塞粒度变小
3. Saga: 基于事件驱动，每个服务都会发布事件，并根据事件执行相应的操作，当操作失败，Saga通过补偿机制来回滚已经执行的操作
4. 消息队列： 将分布式事务拆成多个子任务，并使用消息队列协调他们的顺序，当所有子任务完成时再统一提交和回滚。

2PC,TCC,Saga 都需要xa协议，需要事务协调者，性能不高  ，消息队列属于最终一致性的方式

消息队列+本地事件表+定时任务的方式 实现分布式事务
1. 本地事务中记录事件
2. 定时任务扫描事件，仍入消息队列
3. 消费者，将消息持久化到消费端的本地事件表
4. 定时任务，扫描本地事件表，处理相应逻辑  
> 如果没有本地事件表，本地事务提交后无法保证消息能够发送成功

# 分布式缓存

# 分布式高可用

# 分布式锁

# 分布式任务调度

# 分布式中间件