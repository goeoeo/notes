---
title: MySQL提升课程全面讲解MySQL架构设计

categories: 
- mysql
tags:
- mysql架构
---

# 第一章 实例和故事
## 什么决定了电商双11大促的成败
## 在双11大促的数据库服务器
## 在大促中什么影响了数据库性能
* sql查询数据
* 服务器硬件
* 网卡流量
* 磁盘IO
<!--more-->
### 超高的QPS和TPS带来的影响
QPS: 每秒钟处理的查询量  
* 效率底下的sql
### 大量的并发和超高的CPU使用率
* 大量的并发导致数据库连接被占满（max_connections 默认100）
* 超高的CPU使用率，因为CPU资源耗尽而出现宕机
### 磁盘IO
* 磁盘IO性能突然下降（使用更快的磁盘设备）
* 其它大量消耗磁盘性能的计划任务（调整计划，做好磁盘维护）
### 网卡流量
* 减少从服务器的数量
* 进行分级缓存
* 避免使用select * 进行查询
* 分离业务网络和服务器网络

## 大表带来的问题
### 什么是大表
* 记录行数巨大，单表超过千万行
* 表数据文件巨大，表数据文件超过10G
### 大表对查询的影响
* 慢查询 很难在一定的时间内过滤出所需要的数据
### 大表对DDL的影响
#### 建立索引需要很长的时间  
mysql<5.5 建立索引会锁表  
mysql>=5.5 虽然不会锁表但会引起主从延迟  

#### 修改表结构需要长时间锁表
会造成长时间锁表  
影响正常的数据操作  

#### 如何处理数据库中的大表
* 分库分表把一张大表分成多个小表  
分表的主键选择  
分表后跨分区数据的统计和查询
* 大表的历史数据归档减少对前后端业务的影响
归档的时间点的选择    
如何进行归档操作   

## 大事务带来的问题
### 什么是事务
* 事务是数据库系统区别于其它一切文件系统的重要特性之一
* 事务是一组具有原子性的sql语句，或是一个独立的工作单元

### 大事务
* 运行时间长，操作的数据比较多的事务  
锁定太多的数据，造成大量的阻塞和锁超时  
回滚时所需要时间比较长
执行时间长，容易造成主从延迟

### 如何处理大事务
* 避免一次处理太多的数据
* 移出不必要在事务中的select操作

## 第2章 什么影响了mysql的性能
